---
description: Regenerate architecture.md and review/update architecture.excalidraw
tools: []
scripts:
  sh: .specify/scripts/bash/check-prerequisites.sh --json --paths-only
  ps: .specify/scripts/powershell/check-prerequisites.ps1 -Json -PathsOnly
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## Overview

This command reviews and updates the architecture documentation:
1. Regenerates `.docs/architecture.md` from current codebase state
2. Identifies components that should be in the diagram
3. Prompts to update `.docs/architecture.excalidraw`

## Outline

1. **Scan project structure**:
   - Identify main directories and their purposes
   - Find service/component files
   - Detect external integrations (API calls, database, etc.)

2. **Read current architecture.md** (if exists):
   - Compare documented components with discovered components
   - Identify gaps or outdated sections

3. **Read recent issues** from index:
   - Check for Specs with architecture impact
   - Check for ADRs marked as material

4. **Generate updated architecture.md**:

   ```markdown
   # Architecture Overview

   ## System Components

   ### Core Services
   - **AuthService** - Handles JWT authentication (#101)
   - **UserService** - User management

   ### External Integrations
   - PostgreSQL database
   - Redis for session cache

   ## Data Flow

   [Describe how data flows through the system]

   ## Technology Stack

   - **Language**: TypeScript
   - **Framework**: Express.js
   - **Database**: PostgreSQL
   - **Cache**: Redis

   ## Recent Changes

   - ADR-003: Chose jose for JWT handling
   - Spec #101: Added AuthService component

   ## Diagrams

   See `architecture.excalidraw` for visual diagrams.

   ---
   _Last updated: 2026-01-15_
   _Generated by /jcttech.architecture_
   ```

5. **Identify diagram updates needed**:

   Compare discovered components with what should be in diagram:
   - New services added since last update
   - New integrations
   - Changed data flows

6. **Prompt for Excalidraw update**:

   If changes detected:
   ```
   Architecture changes detected that should be reflected in the diagram:

   New components to add:
   - AuthService (from Spec #101)
   - Redis cache integration

   Would you like to:
   1. Open architecture.excalidraw in VS Code
   2. Generate a component list for manual update
   3. Skip diagram update for now
   ```

7. **Report summary**:
   - Sections updated in architecture.md
   - Components that need diagram attention
   - Link to Excalidraw file

## Component Detection

The command scans for:

| Pattern | Component Type |
|---------|---------------|
| `*Service.ts`, `*Service.py` | Services |
| `*Controller.ts` | Controllers |
| `*Repository.ts` | Data Access |
| `api/*`, `routes/*` | API Endpoints |
| Database connection configs | Database |
| External API clients | Integrations |

## Example Output

```
Architecture Analysis Complete

Files scanned: 47
Components detected: 8

architecture.md updated:
✓ System Components section regenerated
✓ Technology Stack verified
✓ Recent Changes added (2 ADRs, 1 Spec)

Diagram update recommended:
⚠ New component: AuthService
⚠ New integration: Redis cache

To update diagram:
  code .docs/architecture.excalidraw

Or add these to your existing diagram:
- Box: "AuthService" (connects to: UserService, Database)
- Box: "Redis" (connects to: AuthService)
```

## When to Run

- After completing a Spec implementation
- After multiple Stories are done
- When ADRs accumulate
- Before major releases
- When onboarding new team members
