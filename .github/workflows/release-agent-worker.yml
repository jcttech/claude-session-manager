name: Release - Agent Worker

on:
  push:
    tags: ['agent-worker/v*']

permissions:
  contents: write
  packages: write

jobs:
  release:
    uses: jcttech/.github/.github/workflows/python-pipeline.yml@v1
    with:
      tag-prefix: 'agent-worker/'
      package-dir: packages/agent-worker
      setup-command: >-
        uv run python -m grpc_tools.protoc
        -I../../proto
        --python_out=src/agent_worker
        --grpc_python_out=src/agent_worker
        ../../proto/agent.proto
        && sed -i 's/^import agent_pb2/from . import agent_pb2/' src/agent_worker/agent_pb2_grpc.py
      code-paths: |
        packages/agent-worker/**
        proto/**
        pyproject.toml
      python-version: '3.13'
      enable-docker: false
    secrets: inherit
